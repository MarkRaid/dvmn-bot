# Бот для уведомления о результатах проверки задач на dvmn.org

Бот использует long polling [API сайта dvmn.org](https://dvmn.org/api/docs/) для получения уведомлений о проверках работ.

### Создание бота и настройка переменных окружения

Для работы понадобятся бот в Телеграмме

Чтобы создать бота, отправьте пользователю `@BotFather` в Telegram команды `/start` затем `/newbot`. Вы получите API токен для доступа к боту, он выглядит примерно так: `1234567890:ALSDsDFLALFAdjalsdfjsaldfjALDFASJD`, программа ожидает получить токен бота в переменной `TELEGRAM_BOT_TOKEN`.

Чтобы бот смог отправлять логи пользователю, понадобится ID чата с пользователем, его можно получить, написав `@userinfobot`. ID чата выглядит примерно так: `123456789`, его нужно положить в переменную `TELEGRAM_CHAT_ID`.

Чтобы бот смог отправлять пользователю отчеты о результатах проверки задач, понадобится создать новый телеграм-канал и получить его ID. Его можно получить, переслав любое сообщение из созданного канала боту `@userinfobot`. ID канала выглядит примерно так: `-1234567891011`, его нужно положить в переменную `TELEGRAM_CHANNEL_ID`.

Для получения API-токена на сайте dvmn.org, нужно зарегистрироваться на сайте и скопировать ключ со [страницы документации](https://dvmn.org/api/docs/). Он выглядит примерно так: `k77bb727sf3d94dsjf139496192df40s6ba1902400s`. Положите его в переменную `DVMN_API_TOKEN`.

### Запуск через консоль

Для того, чтобы запустить бот непосредственно через консоль вашего сервера, необходимо задать необходимые переменные окружения и запустить файл `main.py`, указав его в качестве аргумента вашего интерпретатора Python.

```bash
$ export DVMN_API_TOKEN=k77bb727sf3d94dsjf139496192df40s6ba1902400s
$ export TELEGRAM_CHAT_ID=123456789
$ export TELEGRAM_CHANNEL_ID=-1234567891011
$ export TELEGRAM_BOT_TOKEN=1234567890:ALSDsDFLALFAdjalsdfjsaldfjALDFASJD
$ python3 main.py
```

### Деплой на Heroku

Код готов к деплою на сервисе [Heroku](heroku.com). Для этого нужно форкнуть этот репозиторий, зарегистрироваться на Heroku и на [странице приложений](https://dashboard.heroku.com/apps) создать новое.

На странице приложения на вкладке `Deploy` нужно связать аккаунты GitHub и Heroku и задеплоить код из основной ветки.

Сервис автоматически установит зависимости из файла `requirements.txt`, считает тип приложения из `Procfile` и запустит бота в окружении, сконфигурированном через `runtime.txt`. Также на вкладке `Resourses` нужно выделить ресурсы для работы бота.

Необходимые переменные окружения нужно задать в `Config Vars` настройках (`Settings`) приложения на web-сервисе Heroku.
